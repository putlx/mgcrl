<!doctype html>
<html lang="zh">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="favicon.ico">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jszip@3.6.0/dist/jszip.min.js"></script>
	<style type="text/css">
		#view img {
			padding-top: 5px;
			padding-bottom: 5px;
		}
	</style>
	<title>mgcrl - Reader</title>
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-light" style="z-index: 1025;">
		<div class="container-fluid">
			<a class="navbar-brand">mgcrl</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarScroll">
				<ul class="navbar-nav me-auto my-2 my-lg-0" style="--bs-scroll-height: 100px;">
					<li class="nav-item">
						<a class="nav-link" href="/">WebUI</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" href="#">Reader</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/putlx/mgcrl">GitHub</a>
					</li>
				</ul>
				<form class="d-flex">
					<input type="file" class="form-control" id="file" accept="image/*,.zip" multiple>
				</form>
			</div>
		</div>
	</nav>

	<div class="text-center" id="view"></div>

	<script>
		window.addEventListener("load", function () {
			const view = document.getElementById("view");
			document.getElementById("file").addEventListener("change", function (event) {
				if (!event.target.files.length) {
					return;
				}
				view.innerHTML = "";
				[...event.target.files].forEach(file => {
					if (file.name.match(/\.zip$/i)) {
						const container = document.createElement("div");
						view.appendChild(container);
						JSZip
							.loadAsync(file)
							.then(zip => zip
								.filter((path, file) => !file.dir && path.match(/\.(bmp|gif|jpg|jpeg|png|webp)$/i))
								.forEach(file => {
									const img = document.createElement("img");
									container.appendChild(img);
									container.appendChild(document.createElement("br"));
									file
										.async("blob")
										.then(file => {
											const reader = new FileReader();
											reader.onload = event => {
												img.addEventListener("load", () => resizeImage(img));
												img.src = event.target.result;
											};
											reader.readAsDataURL(file);
										});
								})
							);
					} else {
						const img = document.createElement("img");
						view.appendChild(img);
						view.appendChild(document.createElement("br"));
						const reader = new FileReader();
						reader.onload = event => {
							img.addEventListener("load", () => resizeImage(img));
							img.src = event.target.result;
						};
						reader.readAsDataURL(file);
					}
				});
			});
		});

		window.addEventListener("resize", () => document.querySelectorAll("#view img").forEach(resizeImage));

		function resizeImage(img) {
			if (window.innerHeight > window.innerWidth) {
				img.width = document.body.clientWidth;
			} else if (img.naturalWidth > document.body.clientWidth) {
				img.width = document.body.clientWidth;
			} else if (img.naturalWidth < img.naturalHeight) {
				img.width = 0.65 * document.body.clientWidth;
			} else {
				img.width = img.naturalWidth;
			}
		}
	</script>

</body>

</html>